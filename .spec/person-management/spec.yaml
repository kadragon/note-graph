spec_id: SPEC-person-1
title: "Person Management and Department History"
description: >
  Manage people (colleagues) with their current department/position
  and track historical department assignments.

given_when_then:
  - given: "System has no persons"
    when: "User creates a new person with ID '310170'"
    then: "Person is stored with ID as primary key"

  - given: "Person exists with current department assignment"
    when: "Person is reassigned to new department"
    then: >
      Previous department assignment is marked inactive (is_active=false, end_date set),
      new assignment created with is_active=true

  - given: "Person has multiple department history entries"
    when: "User views person detail page"
    then: "All department assignments are shown in chronological order"

  - given: "Person is associated with work notes"
    when: "User views person detail"
    then: "Related work notes are listed with person's role (OWNER/RELATED)"

acceptance_tests:
  - id: TEST-person-1
    desc: "Create person with valid data"
    steps:
      - "POST /persons with personId, name, currentDept"
      - "Verify person is created"
      - "Verify auto department history entry created with is_active=true"

  - id: TEST-person-2
    desc: "Update person department triggers history"
    steps:
      - "Create person with dept A"
      - "Update person to dept B"
      - "Verify dept A history has is_active=false and end_date"
      - "Verify dept B history has is_active=true"

  - id: TEST-person-3
    desc: "List person's work notes"
    steps:
      - "Create person"
      - "Create work note associated with person"
      - "GET /persons/{personId}/work-notes"
      - "Verify work note appears in response"

  - id: TEST-person-4
    desc: "Search persons by name"
    steps:
      - "Create multiple persons"
      - "GET /persons?q=partial-name"
      - "Verify filtered results returned"

dependencies:
  governance:
    - "6-digit person ID format"
    - "Department naming convention"

linked_tasks: []

technical_notes:
  - "person_id is 6-character string (e.g., '310170')"
  - "current_dept/position/role_desc denormalized for quick access"
  - "person_dept_history table maintains full history"
  - "Only one history entry can have is_active=true per person"
  - "When creating person, auto-create first history entry if dept provided"

database_schema:
  persons:
    - person_id TEXT PRIMARY KEY
    - name TEXT NOT NULL
    - current_dept TEXT
    - current_position TEXT
    - current_role_desc TEXT
    - created_at TEXT
    - updated_at TEXT

  person_dept_history:
    - id INTEGER PRIMARY KEY AUTOINCREMENT
    - person_id TEXT NOT NULL REFERENCES persons(person_id)
    - dept_name TEXT NOT NULL
    - position TEXT
    - role_desc TEXT
    - start_date TEXT
    - end_date TEXT
    - is_active INTEGER

api_endpoints:
  - method: GET
    path: /persons
    query_params:
      - q: optional search term

  - method: POST
    path: /persons

  - method: GET
    path: /persons/{personId}

  - method: PUT
    path: /persons/{personId}

  - method: GET
    path: /persons/{personId}/history

  - method: GET
    path: /persons/{personId}/work-notes
