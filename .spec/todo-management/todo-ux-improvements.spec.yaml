spec_id: SPEC-todo-2
title: "Todo Completion Date and Recurring Todo Grouping UX Improvements"
description: >
  Improve todo list UX by showing completion dates for completed todos
  and grouping recurring todos to reduce visual clutter.

given_when_then:
  - given: "Todo is marked as completed (status='완료')"
    when: "User views the todo in work note detail or dashboard"
    then: "Completion date (updatedAt) is displayed instead of wait date/due date"

  - given: "Multiple todos exist with same title and repeatRule != NONE"
    when: "User views work note detail todo list"
    then: "Recurring todos are grouped together with instance count indicator"

  - given: "Grouped recurring todos are displayed"
    when: "User clicks on the group"
    then: "Group expands to show all individual instances"

  - given: "Todo is completed and has repeatRule != NONE"
    when: "New recurring instance is automatically created"
    then: "New instance appears in the same recurring group"

acceptance_tests:
  - id: TEST-todo-ux-1
    desc: "Completed todo shows completion date"
    steps:
      - "Create todo with dueDate and waitUntil"
      - "Mark todo as completed"
      - "View todo in work note detail"
      - "Verify '완료: {updatedAt}' is displayed"
      - "Verify waitUntil and dueDate badges are NOT displayed"

  - id: TEST-todo-ux-2
    desc: "In-progress todo shows wait and due dates"
    steps:
      - "Create todo with dueDate and waitUntil"
      - "Keep status as '진행중'"
      - "View todo in work note detail"
      - "Verify '대기: {waitUntil}' is displayed"
      - "Verify '마감: {dueDate}' is displayed"

  - id: TEST-todo-ux-3
    desc: "Recurring todos are grouped by title and repeat rule"
    steps:
      - "Create todo with repeatRule=DAILY"
      - "Complete todo 3 times to generate 3 instances"
      - "View work note detail"
      - "Verify todos are grouped with '3개 반복' indicator"
      - "Verify only one group is shown, not 3 separate items"

  - id: TEST-todo-ux-4
    desc: "Expand/collapse recurring todo group"
    steps:
      - "Create recurring todo group with 3 instances"
      - "Click on group header"
      - "Verify all 3 instances are expanded and visible"
      - "Click again to collapse"
      - "Verify group collapses to single row"

  - id: TEST-todo-ux-5
    desc: "Non-recurring todos are not grouped"
    steps:
      - "Create 3 todos with same title but repeatRule=NONE"
      - "View work note detail"
      - "Verify all 3 todos are displayed separately"
      - "Verify no grouping indicator is shown"

  - id: TEST-todo-ux-6
    desc: "Mixed recurring and non-recurring todos"
    steps:
      - "Create 2 todos: one with repeatRule=WEEKLY, one with NONE"
      - "Complete weekly todo twice"
      - "View work note detail"
      - "Verify weekly todos are grouped (2개)"
      - "Verify non-recurring todo is displayed separately"

dependencies:
  governance:
    - "Todo.updatedAt field represents last modification time"
    - "For completed todos, updatedAt approximates completion time"
    - "Grouping logic: group by (title + repeatRule) when repeatRule != NONE"

linked_tasks:
  - TASK-051
  - TASK-052
  - TASK-053

technical_notes:
  - "Completion date: Use Todo.updatedAt field for completed todos"
  - "Display format: '완료: YYYY년 M월 D일' using formatDateWithYear"
  - "Grouping logic: Group todos by normalized title + repeatRule combination"
  - "Grouping applies only to work note detail view, not dashboard"
  - "Each group shows: title, repeat badge, instance count, latest instance status"
  - "Expand/collapse state managed in component local state"
  - "Consider showing next due date for the group instead of individual dates"

ui_changes:
  TodoItem (Dashboard):
    - "Add conditional rendering: if completed, show '완료: {updatedAt}'"
    - "Remove wait/due date badges for completed todos"

  ViewWorkNoteDialog (Work Note Detail):
    - "Group recurring todos by title + repeatRule"
    - "Add RecurringTodoGroup component for grouped display"
    - "Show instance count and expand/collapse controls"
    - "Keep non-recurring todos in flat list"

implementation_approach:
  frontend:
    - "Create helper function: groupRecurringTodos(todos: Todo[])"
    - "Returns: { recurring: Map<string, Todo[]>, standalone: Todo[] }"
    - "Group key: `${normalizeTitle(title)}_${repeatRule}`"
    - "Add RecurringTodoGroup component with expand/collapse state"
    - "Update TodoItem to show completion date for completed todos"

api_endpoints:
  - note: "No backend changes required - using existing Todo.updatedAt field"
