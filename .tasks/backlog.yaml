tasks:
  # Jest + Miniflare Migration (6 phases)
  - task_id: TASK-MIGRATE-001
    spec_id: SPEC-testing-migration-001
    title: "Phase 1: Jest + Miniflare Environment Setup"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-001
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Install Jest, Miniflare, and dependencies.
      Create jest.config.ts with Miniflare integration.
      Create jest-setup.ts with D1 migration logic.
      Configure parallel test execution scripts.
      Verify empty Jest suite runs alongside Vitest.
      Estimated: 3-4 hours. Risk: Low.

  - task_id: TASK-MIGRATE-002
    spec_id: SPEC-testing-migration-001
    title: "Phase 2: Migrate Unit Tests Batch 1 (Utilities, 6 files)"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-002
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Migrate 6 utility tests with minimal Cloudflare dependencies:
      - chunking.test.ts
      - date-utils.test.ts
      - errors.test.ts
      - schemas.test.ts
      - text-format.test.ts
      - validation.test.ts
      Replace vitest imports with Jest equivalents.
      Estimated: 4-6 hours. Risk: Low.

  - task_id: TASK-MIGRATE-003
    spec_id: SPEC-testing-migration-001
    title: "Phase 3: Migrate Unit Tests Batch 2 (Repositories, 7 files)"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-003
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Migrate 7 repository tests (D1 binding only):
      - department-repository.test.ts
      - embedding-retry-queue-repository.test.ts
      - person-repository.test.ts
      - project-repository.test.ts
      - statistics-repository.test.ts
      - todo-repository.test.ts
      - work-note-repository.test.ts
      Replace 'import { env } from cloudflare:test' with Miniflare D1 bindings.
      Estimated: 6-8 hours. Risk: Medium.

  - task_id: TASK-MIGRATE-004
    spec_id: SPEC-testing-migration-001
    title: "Phase 4: Migrate Unit Tests Batch 3 (Services, 16 files)"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-004
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Migrate 16 service-layer tests with complex bindings:
      - ai-draft-service.test.ts (AI Gateway)
      - embedding-service.test.ts (Vectorize + OpenAI)
      - project-file-service.test.ts (R2)
      - work-note-service.test.ts (Queue)
      - And 12 more service tests
      Replace vi.fn() with jest.fn(), mock R2/Vectorize/AI bindings.
      Estimated: 10-14 hours. Risk: High.

  - task_id: TASK-MIGRATE-005
    spec_id: SPEC-testing-migration-001
    title: "Phase 5: Migrate Integration Tests (7 files)"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-005
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Migrate 7 HTTP integration tests:
      - admin-embedding-failures.test.ts
      - project-files.test.ts
      - project-routes.test.ts
      - statistics-routes.test.ts
      - work-note-file-view.test.ts
      - work-note-project-association.test.ts
      Replace 'SELF.fetch()' with miniflare.dispatchFetch().
      May require worker build step for full stack testing.
      Estimated: 8-10 hours. Risk: High.

  - task_id: TASK-MIGRATE-006
    spec_id: SPEC-testing-migration-001
    title: "Phase 6: Cleanup and Vitest Removal"
    status: pending
    priority: P0
    test_refs:
      - TEST-testing-migration-006
    created_at: 2025-12-29
    updated_at: 2025-12-29
    notes: |
      Delete vitest.config.ts and tests/setup.ts (Vitest version).
      Uninstall vitest, @vitest/coverage-v8, @cloudflare/vitest-pool-workers.
      Update package.json scripts to use Jest only.
      Update CI/CD pipelines (if any).
      Update documentation (README, CONTRIBUTING).
      Update .governance/memory.md with migration summary.
      Final validation: all 614+ tests pass in Jest.
      Estimated: 2-3 hours. Risk: Low.

metadata:
  total_tasks: 6
  total_estimated_effort: 33-45 hours
  phases:
    - name: "Jest + Miniflare Migration"
      tasks: [TASK-MIGRATE-001, TASK-MIGRATE-002, TASK-MIGRATE-003, TASK-MIGRATE-004, TASK-MIGRATE-005, TASK-MIGRATE-006]
      risk: high
      impact: high
      estimated_effort: 33-45 hours
      strategy: progressive
      rollback: git branch per phase

  completed_phases:
    - name: "Phase 1: R2 Utility & Error Handler"
      tasks: [TASK-REFACTOR-001, TASK-REFACTOR-002]
      status: "✅ COMPLETE"
      note: "R2 bucket utility extracted (~35 LOC removed), global error handler middleware applied to all 12 routes (~400 LOC removed). All 595 tests passing."
      completed_date: "2025-12-23"

    - name: "Collapsible Sidebar"
      tasks: [TASK-sidebar-001, TASK-sidebar-002, TASK-sidebar-003, TASK-sidebar-004, TASK-sidebar-005]
      status: "✅ COMPLETE"
      note: "Fully collapsible left sidebar with localStorage persistence, keyboard shortcuts (Cmd+B/Ctrl+B), and accessibility features"

    - name: "Deployment & Docs"
      tasks: [TASK-019]
      status: "✅ COMPLETE"
      note: "Comprehensive documentation created (User Guide, Setup, Architecture, Deployment, API)"

    - name: "Statistics Feature"
      tasks: [TASK-047, TASK-048, TASK-049, TASK-050]
      status: "✅ COMPLETE"
      note: "All tasks completed - backend, frontend, comprehensive tests, and period/year fix"

    - name: "Todo UX Improvements"
      tasks: [TASK-051, TASK-052, TASK-053]
      status: "✅ COMPLETE"
      note: "Completion date display and recurring todo grouping fully implemented with tests"

    - name: "Searchable Assignee Selector"
      tasks: [TASK-024]
      status: "✅ COMPLETE"
      note: "Verified complete implementation with cmdk-based searchable multi-select (already done in previous session)"

    - name: "Person Management UX"
      tasks: [TASK-020, TASK-025]
      status: "✅ COMPLETE"
      note: "Edit person dialog and debounced department search both verified complete (implemented in previous sessions)"
