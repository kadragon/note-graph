# Cloudflare Workers Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/
# Trace: SPEC-ai-draft-1, SPEC-rag-1, TASK-026

name = "note"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Account ID - Replace with your Cloudflare account ID
# account_id = "your-account-id-here"

# ============================================================================
# D1 Database
# ============================================================================
[[d1_databases]]
binding = "DB"
database_name = "worknote-db"
database_id = "04d814ad-5e61-4502-9e1d-85cfcdd1bea9"
migrations_dir = "migrations"

# ============================================================================
# Vectorize
# ============================================================================
[[vectorize]]
binding = "VECTORIZE"
index_name = "worknote-vectors"
remote = true
# Configure via CLI: wrangler vectorize create worknote-vectors --dimensions=1536 --metric=cosine

# ============================================================================
# AI Gateway (for OpenAI API)
# ============================================================================
[ai]
binding = "AI_GATEWAY"
remote = true

# ============================================================================
# Environment Variables (Development)
# ============================================================================
[vars]
ENVIRONMENT = "development"
AI_GATEWAY_ID = "worknote-maker"
OPENAI_MODEL_CHAT = "gpt-5.1"
OPENAI_MODEL_EMBEDDING = "text-embedding-3-small"
OPENAI_MODEL_LIGHTWEIGHT = "gpt-5-mini"

# ============================================================================
# Production Environment Variables (use wrangler secret for sensitive data)
# ============================================================================
# CLOUDFLARE_ACCOUNT_ID - Set via: wrangler secret put CLOUDFLARE_ACCOUNT_ID
# OPENAI_API_KEY - Set via: wrangler secret put OPENAI_API_KEY
# CF_AIG_AUTHORIZATION - (Optional) Set via: wrangler secret put CF_AIG_AUTHORIZATION

# ============================================================================
# Development Settings
# ============================================================================
[dev]
port = 8787
local_protocol = "http"

# ============================================================================
# Build Configuration
# ============================================================================
# Wrangler uses ES modules format by default (no build config needed for TypeScript)

# ============================================================================
# Static Assets
# ============================================================================
[assets]
directory = "public"
binding = "ASSETS"

# ============================================================================
# Observability
# ============================================================================
[observability]
enabled = true

# ============================================================================
# IMPORTANT NOTES
# ============================================================================
# Development Setup:
# 1. Copy .dev.vars.example to .dev.vars
# 2. Update .dev.vars with your CLOUDFLARE_ACCOUNT_ID
# 3. Create D1 database: wrangler d1 create worknote-db
# 4. Create Vectorize index: wrangler vectorize create worknote-vectors --dimensions=1536 --metric=cosine
# 5. Create AI Gateway in Cloudflare Dashboard: https://dash.cloudflare.com/?to=/:account/ai/ai-gateway
# 6. Update AI_GATEWAY_ID in [vars] section with your gateway name
# 7. Update database_id in [[d1_databases]] section after creation
#
# Production Setup:
# 1. Set secrets:
#    - wrangler secret put CLOUDFLARE_ACCOUNT_ID
#    - wrangler secret put OPENAI_API_KEY
#    - wrangler secret put CF_AIG_AUTHORIZATION (optional, if gateway requires auth)
