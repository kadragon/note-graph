# Cloudflare Workers Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "note-graph"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Account ID - Replace with your Cloudflare account ID
# account_id = "your-account-id-here"

# ============================================================================
# D1 Database
# ============================================================================
[[d1_databases]]
binding = "DB"
database_name = "worknote-db"
database_id = "your-d1-database-id-here"  # Replace after creating database
migrations_dir = "migrations"

# ============================================================================
# Vectorize
# ============================================================================
[[vectorize]]
binding = "VECTORIZE"
index_name = "worknote-vectors"
remote = true
# Configure via CLI: wrangler vectorize create worknote-vectors --dimensions=1536 --metric=cosine

# ============================================================================
# AI Gateway (for OpenAI API)
# ============================================================================
[ai]
binding = "AI_GATEWAY"
remote = true

# ============================================================================
# Environment Variables (Development)
# ============================================================================
[vars]
ENVIRONMENT = "development"
# AI_GATEWAY_ID format: {account_id}/{gateway_name}
# Find your account ID at: https://dash.cloudflare.com/?to=/:account/workers
# Example: "1234567890abcdef/worknote-ai-gateway"
AI_GATEWAY_ID = "your-account-id/worknote-ai-gateway"
OPENAI_MODEL_CHAT = "gpt-5.1"
OPENAI_MODEL_EMBEDDING = "text-embedding-3-small"

# ============================================================================
# Production Environment Variables (use wrangler secret for sensitive data)
# ============================================================================
# OPENAI_API_KEY - Set via: wrangler secret put OPENAI_API_KEY

# ============================================================================
# Development Settings
# ============================================================================
[dev]
port = 8787
local_protocol = "http"

# ============================================================================
# Build Configuration
# ============================================================================
# Wrangler uses ES modules format by default (no build config needed for TypeScript)

# ============================================================================
# Static Assets
# ============================================================================
[assets]
directory = "public"
binding = "ASSETS"

# ============================================================================
# Observability
# ============================================================================
[observability]
enabled = true

# ============================================================================
# IMPORTANT NOTES
# ============================================================================
# 1. Create D1 database: wrangler d1 create worknote-db
# 2. Create Vectorize index: wrangler vectorize create worknote-vectors --dimensions=1536 --metric=cosine
# 3. Create AI Gateway in Cloudflare Dashboard: https://dash.cloudflare.com/?to=/:account/ai/ai-gateway
# 4. Update AI_GATEWAY_ID with format: {account_id}/{gateway_name}
# 5. Set secrets: wrangler secret put OPENAI_API_KEY
# 6. (Optional) Set CF_AIG_AUTHORIZATION if gateway requires authentication: wrangler secret put CF_AIG_AUTHORIZATION
# 7. Update account_id, database_id after creation
